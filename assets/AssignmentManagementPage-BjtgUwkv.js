import{j as e}from"./markdown-C51tXKe3.js";import{r as i}from"./router-sIAq8EKR.js";import{A as o,a as S}from"./AdminTable-DaBq8WP4.js";import{c as m}from"./index-CBs_ncIT.js";import{P as C,F as T,q as _,t as D,p as E}from"./icons-CT4s7XVb.js";import"./react-vendor-c5ypKtDW.js";import"./store-DMBmCmPj.js";import"./animation-DJT5yzp0.js";const R=()=>{const[t,l]=i.useState({templates:[],submissions:[],selectedTemplate:null,loading:!0,error:null}),[j,x]=i.useState(!1),[n,h]=i.useState(null),[u,p]=i.useState({feedback:""}),[v,d]=i.useState(!1),[r,c]=i.useState({assignment_date:"",title:"",description:""});i.useEffect(()=>{g()},[]),i.useEffect(()=>{t.selectedTemplate&&f()},[t.selectedTemplate]);const g=async()=>{try{l(a=>({...a,loading:!0,error:null}));const s=await m.getTemplates();s.success&&l(a=>({...a,templates:s.data,selectedTemplate:s.data[0]||null,loading:!1}))}catch(s){l(a=>({...a,error:s instanceof Error?s.message:"템플릿 로딩에 실패했습니다.",loading:!1}))}},f=async()=>{if(t.selectedTemplate)try{const s=await m.getAllSubmissions({assignment_date:t.selectedTemplate.assignment_date});s.success&&l(a=>({...a,submissions:s.data}))}catch(s){l(a=>({...a,error:s instanceof Error?s.message:"제출물 로딩에 실패했습니다."}))}},y=async()=>{try{(await m.createTemplate(r)).success&&(await g(),d(!1),c({assignment_date:"",title:"",description:""}))}catch(s){l(a=>({...a,error:s instanceof Error?s.message:"템플릿 생성에 실패했습니다."}))}},N=[{key:"user",title:"학생",render:(s,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.user?.name||"Unknown"}),e.jsx("div",{className:"text-sm text-gray-500",children:a.user?.email})]})},{key:"submission_text",title:"제출 내용",render:s=>e.jsx("div",{className:"max-w-xs",children:e.jsxs("div",{className:"text-sm text-gray-700 truncate",children:[s.substring(0,100),s.length>100?"...":""]})})},{key:"submitted_at",title:"제출시간",render:s=>e.jsx("span",{className:"text-sm",children:new Date(s).toLocaleString()})},{key:"status",title:"상태",render:s=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s==="reviewed"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:s==="reviewed"?"검토완료":"제출완료"})},{key:"feedback",title:"피드백",render:s=>e.jsx("div",{className:"flex items-center",children:s?e.jsx("span",{className:"text-green-600 text-sm",children:"완료"}):e.jsx("span",{className:"text-gray-400 text-sm",children:"미완료"})})}],w=s=>{h(s),p({feedback:s.feedback||""}),x(!0)},k=async()=>{if(n)try{await m.reviewSubmission(n.id,u.feedback),await f(),x(!1),h(null)}catch(s){l(a=>({...a,error:s instanceof Error?s.message:"리뷰 제출에 실패했습니다."}))}},b={totalSubmissions:t.submissions.length,pendingReview:t.submissions.filter(s=>s.status==="submitted").length,reviewedCount:t.submissions.filter(s=>s.status==="reviewed").length};return t.loading?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"border-l-4 border-amber-500 bg-amber-50 p-4 rounded-lg",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"과제 관리"}),e.jsx("p",{className:"text-amber-700",children:"데이터를 로딩 중입니다..."})]})}):t.error?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"border-l-4 border-red-500 bg-red-50 p-4 rounded-lg",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"과제 관리"}),e.jsxs("p",{className:"text-red-700",children:["오류: ",t.error]}),e.jsx("button",{onClick:g,className:"mt-2 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"다시 시도"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"border-l-4 border-amber-500 bg-amber-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"과제 관리"}),e.jsx("p",{className:"text-amber-700",children:"과제 제출 현황 및 검토 관리"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center space-x-2 px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700",children:[e.jsx(C,{size:16}),e.jsx("span",{children:"새 과제 생성"})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"과제 선택"}),t.templates.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"생성된 과제가 없습니다."}),e.jsx("button",{onClick:()=>d(!0),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"첫 번째 과제 생성하기"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.templates.map(s=>e.jsxs("div",{onClick:()=>l(a=>({...a,selectedTemplate:s})),className:`
                  p-4 border-2 rounded-lg cursor-pointer transition-colors
                  ${t.selectedTemplate?.id===s.id?"border-amber-500 bg-amber-50":"border-gray-200 hover:border-gray-300"}
                `,children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.title}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-600",children:[e.jsxs("span",{children:["날짜: ",new Date(s.assignment_date).toLocaleDateString()]}),e.jsxs("span",{children:["제출: ",t.submissions.filter(a=>a.template_id===s.id).length,"건"]})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description})]},s.id))})]}),t.selectedTemplate&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(o,{title:"총 제출",value:b.totalSubmissions,subtitle:"건",icon:T,color:"blue"}),e.jsx(o,{title:"검토 대기",value:b.pendingReview,subtitle:"건",icon:_,color:"amber"}),e.jsx(o,{title:"검토 완료",value:b.reviewedCount,subtitle:"건",icon:D,color:"green"}),e.jsx(o,{title:"과제 날짜",value:new Date(t.selectedTemplate.assignment_date).toLocaleDateString(),icon:E,color:"gray"})]}),t.selectedTemplate&&e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["제출물 목록 - ",t.selectedTemplate.title]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.selectedTemplate.description})]}),e.jsx(S,{data:t.submissions.filter(s=>s.template_id===t.selectedTemplate.id),columns:N,actions:[{key:"review",label:"검토",variant:"primary",onClick:w}],emptyMessage:"아직 제출된 과제가 없습니다."})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"새 과제 생성"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"과제 날짜"}),e.jsx("input",{type:"date",value:r.assignment_date,onChange:s=>c({...r,assignment_date:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"과제 제목"}),e.jsx("input",{type:"text",value:r.title,onChange:s=>c({...r,title:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"예: Day 1 최종 과제",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"과제 설명"}),e.jsx("textarea",{value:r.description,onChange:s=>c({...r,description:s.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"과제에 대한 상세 설명을 입력하세요",required:!0})]})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>d(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"취소"}),e.jsx("button",{onClick:y,disabled:!r.title||!r.description||!r.assignment_date,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"생성"})]})]})}),j&&n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"과제 검토"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"학생:"})," ",n.user?.name||"Unknown"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"이메일:"})," ",n.user?.email]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium",children:"제출시간:"})," ",new Date(n.submitted_at).toLocaleString()]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"font-medium",children:"제출 내용:"}),e.jsx("div",{className:"mt-2 p-3 bg-white rounded border max-h-40 overflow-y-auto",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm text-gray-700",children:n.submission_text})})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"피드백"}),e.jsx("textarea",{value:u.feedback,onChange:s=>p({...u,feedback:s.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"학생에게 전달할 피드백을 작성하세요"})]})}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>x(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"취소"}),e.jsx("button",{onClick:k,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"검토 저장"})]})]})})]})},$=()=>e.jsx(R,{});export{$ as AssignmentManagementPage};
