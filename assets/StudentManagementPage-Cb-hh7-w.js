import{j as e}from"./markdown-C51tXKe3.js";import{r as a}from"./router-sIAq8EKR.js";import{A as x,a as R}from"./AdminTable-BtTANzdw.js";import{u as h,S as T}from"./userApi-BTYvFI7e.js";import{a as Q,m as p,S as B,U as k}from"./icons-BTB9q9YK.js";import"./react-vendor-c5ypKtDW.js";import"./index-8MKmb4U0.js";import"./store-DMBmCmPj.js";import"./animation-DJT5yzp0.js";const $=()=>{const[C,_]=a.useState([]),[d,U]=a.useState(null),[g,E]=a.useState(""),[o,I]=a.useState("all"),[c,z]=a.useState("all"),[A,v]=a.useState(!1),[i,l]=a.useState(!1),[y,n]=a.useState(null),[u,N]=a.useState(null),[b,F]=a.useState(1),[S,M]=a.useState(0),m=50,j=async()=>{l(!0),n(null);try{const s=await h.getAllUsers({role:"student",cohort:o==="all"?void 0:o,search:g||void 0,skip:(b-1)*m,limit:m});if(s.success){let r=s.data.map(t=>({...t,studentId:t.student_id||"",status:t.is_active?"registered":"pending",totalLearningTime:0,completedItems:0}));c!=="all"&&(r=r.filter(t=>t.status===c)),_(r),M(s.total||0)}}catch(s){n(s instanceof Error?s.message:"Failed to fetch students")}finally{l(!1)}},f=async()=>{try{const s=await h.getUserStats();s.success&&U(s.data)}catch(s){console.error("Failed to fetch user stats:",s)}};a.useEffect(()=>{j()},[b,o,c,g]),a.useEffect(()=>{f()},[]);const P=[{key:"name",header:"이름",render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})},{key:"student_id",header:"학번",render:s=>s.student_id||"-",width:"120px"},{key:"department",header:"학과",render:s=>s.department||"-",width:"150px"},{key:"cohort",header:"기수",render:s=>s.cohort||"-",width:"100px"},{key:"status",header:"상태",render:s=>e.jsx(T,{status:s.status,size:"sm"}),width:"100px"},{key:"created_at",header:"가입일",render:s=>s.created_at?new Date(s.created_at).toLocaleDateString():"-",width:"120px"},{key:"completedItems",header:"진행도",render:s=>e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",children:[s.completedItems||0,"/15"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[Math.round((s.completedItems||0)/15*100),"%"]})]}),width:"100px"}],w=async(s,r)=>{try{l(!0);const t=r==="registered";await h.toggleUserStatus(s.id,t),await j(),await f()}catch(t){n(t instanceof Error?t.message:"Failed to update user status")}finally{l(!1)}},L=async s=>{const r=s.target.files?.[0];if(r)try{l(!0),n(null);const t=await h.bulkCreateUsers(r);t.success&&(N(t.data),await j(),await f())}catch(t){n(t instanceof Error?t.message:"Failed to upload users")}finally{l(!1)}},V={currentPage:b,totalPages:Math.ceil(S/m),totalItems:S,pageSize:m,onPageChange:F},D=s=>{console.log("Edit student:",s.id)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-l-4 border-amber-500 bg-amber-50 p-4 rounded-lg",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"학생 관리"}),e.jsx("p",{className:"text-amber-700",children:"허용된 학생 명단 및 상태 관리"})]}),y&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center space-x-3",children:[e.jsx(Q,{size:20,className:"text-red-500 flex-shrink-0"}),e.jsx("div",{className:"text-red-700",children:y}),e.jsx("button",{onClick:()=>n(null),className:"ml-auto text-red-500 hover:text-red-700",children:"×"})]}),u&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-green-800 mb-2",children:"업로드 완료!"}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsxs("p",{children:["생성: ",u.created_count,"명"]}),e.jsxs("p",{children:["건너뜀: ",u.skipped_count,"명"]}),e.jsxs("p",{children:["오류: ",u.error_count,"명"]})]}),e.jsx("button",{onClick:()=>N(null),className:"mt-2 text-green-500 hover:text-green-700 text-sm",children:"닫기"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(x,{title:"총 학생 수",value:d?.total_users||0,icon:p,color:"blue"}),e.jsx(x,{title:"활성 사용자",value:d?.active_users||0,icon:p,color:"green"}),e.jsx(x,{title:"비활성 사용자",value:d?.inactive_users||0,icon:p,color:"amber"}),e.jsx(x,{title:"학생",value:d?.role_distribution?.student||0,icon:p,color:"blue"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(B,{size:20,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"이름, 이메일, 학번 검색...",value:g,onChange:s=>E(s.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:o,onChange:s=>I(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"전체 기수"}),e.jsx("option",{value:"2024-08",children:"2024-08"}),e.jsx("option",{value:"2024-09",children:"2024-09"})]}),e.jsxs("select",{value:c,onChange:s=>z(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"전체 상태"}),e.jsx("option",{value:"pending",children:"가입 대기"}),e.jsx("option",{value:"registered",children:"가입 완료"}),e.jsx("option",{value:"blocked",children:"차단됨"})]})]}),e.jsxs("button",{onClick:()=>v(!0),className:"flex items-center space-x-2 px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors",children:[e.jsx(k,{size:20}),e.jsx("span",{children:"CSV 업로드"})]})]})}),i?e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-12 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"데이터를 불러오는 중..."})]})}):e.jsx(R,{data:C,columns:P,actions:[{label:"승인",variant:"primary",onClick:s=>w(s,"registered")},{label:"차단",variant:"danger",onClick:s=>w(s,"blocked")},{label:"편집",onClick:D}],pagination:V}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"학생 명단 CSV 업로드"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"기수 선택"}),e.jsxs("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"2024-08",children:"2024-08"}),e.jsx("option",{value:"2024-09",children:"2024-09"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"CSV 파일"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(k,{size:48,className:"mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"CSV 파일을 드래그하거나 클릭하여 업로드"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"형식: name, email, student_id, department"}),e.jsx("input",{type:"file",accept:".csv",onChange:L,className:"hidden",id:"csv-upload",disabled:i}),e.jsx("label",{htmlFor:"csv-upload",className:`inline-block px-4 py-2 text-white rounded cursor-pointer ${i?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}`,children:i?"업로드 중...":"파일 선택"})]})]}),e.jsx("div",{className:"flex space-x-3",children:e.jsx("button",{onClick:()=>v(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"취소"})})]})})]})},Z=()=>e.jsx($,{});export{Z as StudentManagementPage};
